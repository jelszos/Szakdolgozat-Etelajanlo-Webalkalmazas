import{d as de,u as ue,i as V,r as v,o as ce,f as pe,g as Ee,c as K,B as ie,C as ye,_ as ke,j as b,t as A,s as i,I as oe,q as o,y as a,K as W,L as se,M as J,O as re,F as M,v as H,D as U,m as r,l as O,E as N,k as u}from"./app-9yHSs_0k.js";import{u as ze}from"./index-CQAvtwPr.js";import{R as Ne}from"./recipe.service-oeltP7nx.js";import{u as we}from"./date-format-GlMVmkoP.js";import{r as T,m as ae,a as le}from"./index-DDs_-EvW.js";import{U as Ce}from"./user.service-CvLjCrJx.js";import{U as Re}from"./unit.model-CaFlzA60.js";import{I as me}from"./ingredient.service-BzC0g82u.js";import{h as Ue}from"./header-bg-C45d2Xww.js";var ve=(e=>(e.CHINESE="CHINESE",e.ITALIAN="ITALIAN",e.HUNGARIAN="HUNGARIAN",e.MEXICAN="MEXICAN",e.INDIAN="INDIAN",e.JAPANESE="JAPANESE",e.THAI="THAI",e.AMERICAN="AMERICAN",e.EASTERN_EUROPEAN="EASTERN_EUROPEAN",e.VIETNAMESE="VIETNAMESE",e.RUSSIAN="RUSSIAN",e.SPANISH="SPANISH",e.FRENCH="FRENCH",e.GREEK="GREEK",e.MIDDLE_EASTERN="MIDDLE_EASTERN",e.LATIN_AMERICAN="LATIN_AMERICAN",e.BRITISH="BRITISH",e.AUSTRALIAN="AUSTRALIAN",e.UKRAINIAN="UKRAINIAN",e.GERMAN="GERMAN",e))(ve||{}),fe=(e=>(e.APPETIZER="APPETIZER",e.DESSERT="DESSERT",e.SOUP="SOUP",e.STEW="STEW",e.SAUCE="SAUCE",e.SALAD="SALAD",e.NOODLE="NOODLE",e))(fe||{});class Ve{constructor(t,$,p,S,w,E,C,c,f,y,g,k){this.id=t,this.title=$,this.description=p,this.ingredientNames=S,this.foodCategory=w,this.foodType=E,this.imageUrl=C,this.createdDate=c,this.user=f,this.instructions=y,this.ratings=g,this.isFavorite=k}}const De=de({compatConfig:{MODE:3},name:"Ingredient",setup(){const{t:e}=ue(),t=V("ingredientService",()=>new me),$=V("alertService",()=>pe(),!0),p=v([]),S=v(!1),w=()=>{},E=async()=>{S.value=!0;try{const l=await t().retrieve();p.value=l.data}catch(l){$.showHttpError(l.response)}finally{S.value=!1}},C=()=>{E()};ce(async()=>{await E()});const c=v(null),f=v(null),y=l=>{c.value=l.id,f.value.show()},g=()=>{f.value.hide()};return{ingredients:p,handleSyncList:C,isFetching:S,retrieveIngredients:E,clear:w,removeId:c,removeEntity:f,prepareRemove:y,closeDialog:g,removeIngredient:async()=>{try{await t().delete(c.value);const l=e("szakdolgozatApp.ingredient.deleted",{param:c.value}).toString();$.showInfo(l,{variant:"danger"}),c.value=null,E(),g()}catch(l){$.showHttpError(l.response)}},t$:e}}}),Te=de({name:"RecipeUpdate",components:{Ingredient:De,FontAwesomeIcon:Ee},compatConfig:{MODE:3},setup(){var te;const e=V("recipeService",()=>new Ne),t=V("alertService",()=>pe(),!0),$=V("ingredientService",()=>new me),p=v(new Ve),S=V("userService",()=>new Ce),w=v([]),E=v(Object.keys(ve)),C=v(Object.keys(fe)),c=v(Object.keys(Re)),f=v(!1),y=V("currentLanguage",()=>K(()=>navigator.language??"en"),!0),g=v(!1),k=v([]);k.value=n(k.value);const l=[],X=K(()=>Object.values(k.value)),q=K(()=>X.value.filter(s=>l.indexOf(s)===-1).sort((s,d)=>s.localeCompare(d))),_=v([]),D=v(!1),h=v({title:"",requiredTime:null,description:"",ingredients:[{name:null,amount:null,unit:null}]});K(()=>h.value.ingredients.map(s=>s.name).filter(Boolean));function P(s){const d=h.value.ingredients.map(z=>z.name);return q.value.filter(z=>z===h.value.ingredients[s].name||!d.includes(z))}const j=ie().path=="/recipe/new",L=ie(),B=ye(),F=()=>B.go(-1);function n(s){return Object.fromEntries(Object.entries(s).filter(([d,z])=>d!="null"&&z!=""))}const I=async s=>{try{const d=await e().find(s);d.createdDate=new Date(d.createdDate),p.value=d}catch(d){t.showHttpError(d.response)}},m=async()=>{try{const s=await $().retrieveUniqueIngredients();k.value=s.data,console.log(s.data)}catch{}};(te=L.params)!=null&&te.recipeId&&I(L.params.recipeId),ce(async()=>{await m()}),(()=>{S().retrieve().then(s=>{w.value=s.data})})();const{t:R}=ue(),Z={title:{required:T,minLength:ae(5),maxLength:le(50)},description:{required:T,minLength:ae(1),maxLength:le(254)},ingredientNames:{},foodCategory:{required:T},foodType:{required:T},imageUrl:{required:T},instructions:{required:T},createdDate:{},user:{}},x=ze(Z,p);x.value.$validate(),v();function ge(s){const d=s.target;if(d&&d.files){const z=new FormData,Y=d.files[0];z.append("file",Y),e().uploadImage(z).then(ne=>{this.recipe.imageUrl=ne,console.log("img path res",ne)})}}function he(){h.value.ingredients.push({name:null,amount:null,unit:null})}function Ie(s){h.value.ingredients.splice(s,1)}function Q(){h.value={title:"",requiredTime:null,description:"",ingredients:[{name:null,amount:null,unit:null}]},D.value=!1}function ee(){return h.value.requiredTime&&h.value.description&&h.value.ingredients.every(s=>s.name&&s.amount&&s.unit)}function be(){if(!ee()){t.showError("Wrong field(s)!");return}_.value.push({...h.value}),p.value.instructions=_.value,Q()}function Ae(s){g.value=!0,D.value=!0,h.value=s}function $e(){if(!ee()){t.showError("Wrong fields!");return}D.value=!1,g.value=!1,Q()}function Se(s){var d;p.value.instructions=(d=p.value.instructions)==null?void 0:d.filter((z,Y)=>s!=Y)}return{headerBg:Ue,deleteInstruction:Se,closeInstructionModal:$e,editInstructions:g,editInstruction:Ae,onFileChanged:ge,recipeService:e,alertService:t,recipe:p,previousState:F,foodCategoryValues:E,foodTypeValues:C,unitValues:c,submitInstructionForm:be,removeIngredient:Ie,addIngredient:he,instructions:_,resetForm:Q,availableIngredients:q,filteredIngredients:P,ingredientValue:l,instructionFormData:h,showInstructionForm:D,isSaving:f,currentLanguage:y,users:w,isNewRecipe:j,v$:x,...we({entityRef:p}),t$:R}},created(){},methods:{getIngredientNames(){var t;let e="";return e=(t=this.recipe.instructions)==null?void 0:t.flatMap($=>{var p;return(p=$.ingredients)==null?void 0:p.map(S=>S.name)}).join(","),e},save(){this.isSaving=!0,this.recipe.id?(this.recipe.ingredientNames=this.getIngredientNames(),this.recipeService().update(this.recipe).then(e=>{this.isSaving=!1,this.previousState(),this.alertService.showInfo(this.t$("szakdolgozatApp.recipe.updated",{param:e.id}))}).catch(e=>{this.isSaving=!1,this.alertService.showHttpError(e.response)})):this.recipeService().create(this.recipe).then(e=>{this.isSaving=!1,this.previousState(),this.alertService.showSuccess(this.t$("szakdolgozatApp.recipe.created",{param:e.id}).toString())}).catch(e=>{this.isSaving=!1,this.alertService.showHttpError(e.response)})}}}),_e={class:"row justify-content-center"},Le={class:"container"},Me={class:"position-relative text-center my-5"},He=["textContent"],Oe={class:"form-group"},qe=["textContent"],Pe={class:"form-group"},je=["textContent"],Be={class:"form-group"},Fe=["textContent"],Ge=["value","label"],Ke={class:"form-group"},We=["textContent"],Je=["value","label"],Xe={class:"form-group"},Ze=["textContent"],Qe={key:0,class:"image-preview d-flex justify-content-center mb-4"},Ye=["src"],xe={class:"text-center"},et={class:""},tt={class:"d-flex flex-column gap text-slate-900"},nt={class:"w-100 d-flex justify-content-center"},it={class:"instruction-number text-slate-900 bg-warning"},ot={class:"d-flex justify-content-between"},st={class:"mb-3"},rt={style:{"font-weight":"500"}},at={class:"instruction-buttons"},lt={class:"recipe-creation-custom-grid"},dt={key:0,style:{"font-size":"18px","font-weight":"500"}},ut={class:"ml-3"},ct=["textContent"],pt=["disabled"],mt=["textContent"];function vt(e,t,$,p,S,w){var P,j,L,B,F;const E=b("b-img"),C=b("b-form-file"),c=b("font-awesome-icon"),f=b("b-button"),y=b("b-form-input"),g=b("b-form-group"),k=b("b-form-select"),l=b("b-col"),X=b("b-form-row"),q=b("b-form"),_=b("b-modal"),D=b("b-alert"),h=b("b-row");return u(),A("div",_e,[i("div",Le,[i("form",{name:"editForm",novalidate:"",onSubmit:t[11]||(t[11]=oe(n=>e.save(),["prevent"]))},[t[19]||(t[19]=i("h2",{id:"szakdolgozatApp.recipe.home.createOrEditLabel","data-cy":"RecipeCreateUpdateHeading"},null,-1)),i("div",Me,[o(E,{src:e.headerBg,class:"carousel-header-img"},null,8,["src"]),i("h1",{class:"carousel-header mb-4 position-relative",textContent:a(e.isNewRecipe?e.t$("szakdolgozatApp.recipe.home.createLabel"):e.t$("szakdolgozatApp.recipe.home.createOrEditLabel"))},null,8,He)]),i("div",null,[i("div",Oe,[i("label",{class:"form-control-label",textContent:a(e.t$("szakdolgozatApp.recipe.title")),for:"recipe-title"},null,8,qe),W(i("input",{type:"text",class:J(["form-control",{valid:!e.v$.title.$invalid,invalid:e.v$.title.$invalid}]),name:"title",id:"recipe-title","data-cy":"title","onUpdate:modelValue":t[0]||(t[0]=n=>e.v$.title.$model=n)},null,2),[[se,e.v$.title.$model]])]),i("div",Pe,[i("label",{class:"form-control-label",textContent:a(e.t$("szakdolgozatApp.recipe.description")),for:"recipe-description"},null,8,je),W(i("textarea",{type:"text",class:J(["form-control",{valid:!e.v$.description.$invalid,invalid:e.v$.description.$invalid}]),name:"description",id:"recipe-description","data-cy":"description","onUpdate:modelValue":t[1]||(t[1]=n=>e.v$.description.$model=n)},null,2),[[se,e.v$.description.$model]])]),i("div",Be,[i("label",{class:"form-control-label",textContent:a(e.t$("szakdolgozatApp.recipe.foodCategory")),for:"recipe-foodCategory"},null,8,Fe),W(i("select",{class:J(["form-control",{valid:!e.v$.foodCategory.$invalid,invalid:e.v$.foodCategory.$invalid}]),name:"foodCategory","onUpdate:modelValue":t[2]||(t[2]=n=>e.v$.foodCategory.$model=n),id:"recipe-foodCategory","data-cy":"foodCategory"},[(u(!0),A(M,null,H(e.foodCategoryValues,n=>(u(),A("option",{key:n,value:n,label:e.t$("szakdolgozatApp.FoodCategory."+n)},a(n),9,Ge))),128))],2),[[re,e.v$.foodCategory.$model]])]),i("div",Ke,[i("label",{class:"form-control-label",textContent:a(e.t$("szakdolgozatApp.recipe.foodType")),for:"recipe-foodType"},null,8,We),W(i("select",{class:J(["form-control",{valid:!e.v$.foodType.$invalid,invalid:e.v$.foodType.$invalid}]),name:"foodType","onUpdate:modelValue":t[3]||(t[3]=n=>e.v$.foodType.$model=n),id:"recipe-foodType","data-cy":"foodType"},[(u(!0),A(M,null,H(e.foodTypeValues,n=>(u(),A("option",{key:n,value:n,label:e.t$("szakdolgozatApp.FoodType."+n)},a(n),9,Je))),128))],2),[[re,e.v$.foodType.$model]])]),i("div",Xe,[i("label",{class:"form-control-label",textContent:a(e.t$("szakdolgozatApp.recipe.imageUrl")),for:"recipe-imageUrl"},null,8,Ze),o(C,{id:"file-default",name:"imageUrl",onChange:t[4]||(t[4]=n=>e.onFileChanged(n))})]),(P=e.recipe)!=null&&P.imageUrl?(u(),A("div",Qe,[i("img",{src:(j=e.recipe)==null?void 0:j.imageUrl,alt:"recipeImg"},null,8,Ye)])):U("",!0),i("div",xe,[o(f,{onClick:t[5]||(t[5]=n=>e.showInstructionForm=!0),variant:"primary"},{default:r(()=>[o(c,{icon:"plus"}),N(" "+a(e.t$("szakdolgozatApp.recipe.addInstruction.title")),1)]),_:1})]),i("div",et,[o(_,{id:"modal-ingredient-form",modelValue:e.showInstructionForm,"onUpdate:modelValue":t[9]||(t[9]=n=>e.showInstructionForm=n),onHide:e.resetForm,title:e.t$("szakdolgozatApp.recipe.addInstruction.title"),"hide-footer":"","no-close-on-backdrop":""},{default:r(()=>[o(q,{onSubmit:oe(e.submitInstructionForm,["prevent"])},{default:r(()=>[o(g,{label:e.t$("szakdolgozatApp.recipe.title"),"label-for":"title"},{default:r(()=>[o(y,{id:"title",type:"text",name:"instructionTitle",modelValue:e.instructionFormData.title,"onUpdate:modelValue":t[6]||(t[6]=n=>e.instructionFormData.title=n),required:"",placeholder:e.t$("szakdolgozatApp.recipe.addInstruction.titlePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:e.t$("szakdolgozatApp.recipe.addInstruction.timeLabel"),"label-for":"time"},{default:r(()=>[o(y,{id:"time",type:"number",name:"instructionRequiredTime",modelValue:e.instructionFormData.requiredTime,"onUpdate:modelValue":t[7]||(t[7]=n=>e.instructionFormData.requiredTime=n),min:"1",required:"",placeholder:e.t$("szakdolgozatApp.recipe.addInstruction.timePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(g,{label:e.t$("szakdolgozatApp.recipe.addInstruction.descriptionLabel"),"label-for":"description"},{default:r(()=>[o(y,{id:"description",type:"text",name:"instructionDescription",modelValue:e.instructionFormData.description,"onUpdate:modelValue":t[8]||(t[8]=n=>e.instructionFormData.description=n),required:"",placeholder:e.t$("szakdolgozatApp.recipe.addInstruction.descriptionPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),(u(!0),A(M,null,H(e.instructionFormData.ingredients,(n,I)=>(u(),A("div",{key:I,class:"mb-3"},[o(X,null,{default:r(()=>[o(l,{cols:"6"},{default:r(()=>[o(g,{label:I+1+". "+e.t$("szakdolgozatApp.recipe.addInstruction.ingredient"),"label-for":"ingredient-select-"+I},{default:r(()=>[o(k,{id:"ingredient-select-"+I,name:"instructionIngredients",modelValue:n.name,"onUpdate:modelValue":m=>n.name=m,options:e.filteredIngredients(I),required:""},null,8,["id","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label","label-for"])]),_:2},1024),o(l,{cols:"3"},{default:r(()=>[o(g,{label:e.t$("szakdolgozatApp.recipe.addInstruction.amount"),"label-for":"'amount-' + index"},{default:r(()=>[o(y,{id:"amount-"+I,name:"ingredientAmount",modelValue:n.amount,"onUpdate:modelValue":m=>n.amount=m,type:"number",min:"1",required:""},null,8,["id","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),o(l,{cols:"3"},{default:r(()=>[o(g,{label:e.t$("szakdolgozatApp.recipe.addInstruction.unit"),"label-for":"'unit-select-' + index"},{default:r(()=>[o(k,{id:"unit-select-"+I,name:"ingredientUnit",modelValue:n.unit,"onUpdate:modelValue":m=>n.unit=m,options:e.unitValues,required:""},null,8,["id","modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"])]),_:2},1024),o(l,{cols:"12",class:"text-right"},{default:r(()=>[e.instructionFormData.ingredients.length>1?(u(),O(f,{key:0,variant:"danger",size:"sm",onClick:m=>e.removeIngredient(I)},{default:r(()=>[o(c,{icon:"trash"})]),_:2},1032,["onClick"])):U("",!0)]),_:2},1024)]),_:2},1024)]))),128)),o(f,{class:"w-100",variant:"secondary",size:"sm",onClick:e.addIngredient},{default:r(()=>[o(c,{icon:"plus"}),N(" "+a(e.t$("szakdolgozatApp.recipe.addInstruction.addAnother")),1)]),_:1},8,["onClick"]),t[12]||(t[12]=i("hr",null,null,-1)),e.editInstructions?U("",!0):(u(),O(f,{key:0,type:"submit",variant:"primary",onClick:e.submitInstructionForm},{default:r(()=>[N(a(e.t$("szakdolgozatApp.recipe.addInstruction.submit")),1)]),_:1},8,["onClick"])),e.editInstructions?(u(),O(f,{key:1,type:"button",variant:"primary",onClick:e.closeInstructionModal},{default:r(()=>[N(a(e.t$("szakdolgozatApp.recipe.addInstruction.submit")),1)]),_:1},8,["onClick"])):U("",!0)]),_:1},8,["onSubmit"])]),_:1},8,["modelValue","onHide","title"])]),((B=(L=e.recipe)==null?void 0:L.instructions)==null?void 0:B.length)>0||(F=e.v$.recipe)!=null&&F.instructions.$error?(u(),O(h,{key:1},{default:r(()=>[o(l,null,{default:r(()=>{var n,I;return[t[16]||(t[16]=i("p",{class:"instruction-text text-slate-900 mb-5 mt-3"},"Instructions:",-1)),i("div",tt,[(u(!0),A(M,null,H((n=e.recipe)==null?void 0:n.instructions,(m,G)=>(u(),A("div",{key:G,class:"instructions-section position-relative"},[i("div",nt,[i("p",it,a(G+1),1)]),i("div",ot,[i("div",st,[o(c,{icon:"clock",style:{color:"#5a5a5a"}}),i("span",rt,a(m.requiredTime)+" minutes",1)]),i("div",at,[o(f,{size:"sm",variant:"warning",onClick:R=>e.editInstruction(m)},{default:r(()=>t[13]||(t[13]=[N("Edit")])),_:2},1032,["onClick"]),o(f,{size:"sm",variant:"danger",onClick:R=>e.deleteInstruction(G)},{default:r(()=>[o(c,{icon:"trash"})]),_:2},1032,["onClick"])])]),i("div",lt,[i("div",null,[(m==null?void 0:m.ingredients.length)>0?(u(),A("p",dt,"Ingredients")):U("",!0),(u(!0),A(M,null,H(m.ingredients,(R,Z)=>(u(),A("div",{key:Z},a(R.amount)+" "+a(R.unit)+" of "+a(R.name),1))),128))]),i("div",ut,[t[14]||(t[14]=i("p",{style:{"font-weight":"500","font-size":"18px"}},"Description",-1)),i("p",null,a(m.description),1)])])]))),128))]),(I=e.v$.recipe)!=null&&I.instructions.$error?(u(),O(D,{key:0,variant:"danger"},{default:r(()=>t[15]||(t[15]=[N(" Instructions are required and must contain valid entries. ")])),_:1})):U("",!0)]}),_:1})]),_:1})):U("",!0)]),i("div",null,[i("button",{type:"button",id:"cancel-save","data-cy":"entityCreateCancelButton",class:"btn btn-secondary",onClick:t[10]||(t[10]=n=>e.previousState())},[o(c,{icon:"ban"}),t[17]||(t[17]=N(" ")),i("span",{textContent:a(e.t$("entity.action.cancel"))},null,8,ct)]),i("button",{type:"submit",id:"save-entity","data-cy":"entityCreateSaveButton",disabled:e.v$.$invalid||e.isSaving,class:"btn btn-primary ml-2"},[o(c,{icon:"save"}),t[18]||(t[18]=N(" ")),i("span",{textContent:a(e.t$("entity.action.save"))},null,8,mt)],8,pt)])],32)])])}const yt=ke(Te,[["render",vt]]);export{yt as default};
