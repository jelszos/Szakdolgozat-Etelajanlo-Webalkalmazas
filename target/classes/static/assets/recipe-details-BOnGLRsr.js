import{d as oe,g as ae,i as N,B as se,C as ne,G as le,r as A,c as re,u as de,V as ce,S as ue,f as pe,_ as me,j as v,t as y,s as i,q as o,m as l,y as r,F as B,k as p,I as te,E as b,l as C,D as z,T as ge,v as Q}from"./app-9yHSs_0k.js";import{R as fe}from"./recipe.service-oeltP7nx.js";import{u as ve}from"./date-format-GlMVmkoP.js";import{R as be}from"./rating.model-C9oCRbPj.js";import{R as ye}from"./rating.service-IMA_Zjbv.js";import{f as ie}from"./functions-BhiSqBls.js";import{F as ke}from"./favorite-relation.service-D7ARiYm2.js";import{_ as he}from"./CreateRecipeBookForm.vue_vue_type_script_setup_true_lang-C0RjFM7P.js";import{_ as we}from"./MarkOrCreateRB.vue_vue_type_script_setup_true_lang-Ybhu4xwr.js";import"./recipe-book.service-D-CAdHjl.js";const _e=oe({name:"RecipeDetails",components:{MarkOrCreateRB:we,CreateRecipeBookForm:he,FontAwesomeIcon:ae},compatConfig:{MODE:3},setup(){var I;const e=ve(),s=N("recipeService",()=>new fe),V=N("loginService",()=>new ue),_=N("alertService",()=>pe(),!0),L=N("ratingService",()=>new ye,!0),ee=N("favoriteService",()=>new ke),h=se(),U=ne(),u=le(),O=A({isOpen:!1,recipe:{}}),w=()=>U.go(-1),d=A({}),M=A(!1),R=A(new be),D=A(!1),E=A(!1),S=A(!1),X=async n=>{var m;try{const t=await s().find(n);t.ratings=(m=t.ratings)==null?void 0:m.sort((c,a)=>{var F,$,T,j;const f=((F=c==null?void 0:c.user)==null?void 0:F.id)===(($=u==null?void 0:u.account)==null?void 0:$.id),g=((T=a==null?void 0:a.user)==null?void 0:T.id)===((j=u==null?void 0:u.account)==null?void 0:j.id);return f&&!g?-1:!f&&g?1:0}),d.value=t}catch(t){_.showHttpError(t==null?void 0:t.response)}},Y=re(()=>{var n;return E.value?d.value.ratings:(n=d.value.ratings)==null?void 0:n.slice(0,2)});(I=h.params)!=null&&I.recipeId&&X(h.params.recipeId);function H(){var m,t;return!((t=(m=d==null?void 0:d.value)==null?void 0:m.ratings)==null?void 0:t.some(c=>{var a,f,g,F,$;return((a=c==null?void 0:c.user)==null?void 0:a.id)==((f=u==null?void 0:u.account)==null?void 0:f.id)||((F=(g=d==null?void 0:d.value)==null?void 0:g.user)==null?void 0:F.id)==(($=u==null?void 0:u.account)==null?void 0:$.id)}))}function Z(n){var m,t;return((m=n==null?void 0:n.user)==null?void 0:m.id)==((t=u==null?void 0:u.account)==null?void 0:t.id)}function x(n){D.value=!0,k.value={...n},console.log(k.value),M.value=!M.value}const k=A({title:"",description:"",rate:0,imageUrl:"",recipe:d.value});function P(){k.value={title:"",description:"",rate:0,imageUrl:"",recipe:d.value}}function q(){return k.value.rate}async function G(){u!=null&&u.account||V.openLogin(),q()&&(D.value?(R.value=k.value,R.value.recipe=d.value,L().update(R.value).then(n=>{var t;const m=(t=d.value.ratings)==null?void 0:t.findIndex(c=>c.id===n.id);m!==-1&&ce.set(d.value.ratings,m,n),_.showSuccess("Updated successfully!")}).catch(n=>{_.showHttpError(n.response)})):(R.value=k.value,console.log("data",k.value),await L().createWithRecipe(R.value,d.value.id).then(n=>{d.value.ratings=[n,...d.value.ratings],console.log(d.value.ratings),_.showSuccess("Rating created successfully!")}).catch(n=>{_.showHttpError(n.response)})),P(),M.value=!1)}function W(n){n||_.showError("No rating ID found!"),L().delete(n).then(m=>{var c,a;if(m.status!=204)return _.showError("Something went wrong. Please try it again later!");const t=(c=d.value.ratings)==null?void 0:c.findIndex(f=>f.id===n);t!==-1&&((a=d.value.ratings)==null||a.splice(t,1),_.showSuccess("Deleted your rating successfully!"))})}function J(n){const m=n.target;if(m&&m.files){const t=new FormData,c=m.files[0];t.append("file",c),s().uploadImage(t).then(a=>{k.value.imageUrl=a,console.log("img path res",a)})}}function K(){k.value.imageUrl=""}return{...e,store:u,alertService:_,recipe:d,submitRating:G,ratingFormData:k,visibilityRatingEditForm:M,toggleEditRatingForm:x,isMyComment:Z,isRatingFormVisible:H,deleteRating:W,showAllRatings:E,limitedRatings:Y,onFileChanged:J,deleteImgFromRating:K,loginService:V,favoriteService:ee,isAddFavModalData:O,newRecipeBFormVisible:S,previousState:w,t$:de().t}},computed:{functions(){return ie}},methods:{getAvatarImg:e=>ie.getAvatarImg(e),formatFoodCategory(e){return e?e.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):""},toggleFavorite(){var e,s;if((e=this.store)!=null&&e.account){this.favoriteService().create({recipe:this.recipe}).then(V=>{(V.status==204||V.status==201)&&(this.recipe.isFavorite=!this.recipe.isFavorite)});return}(s=this.loginService)==null||s.openLogin()},markRecipe(){var e,s;if((e=this.store)!=null&&e.account){this.isAddFavModalData.recipe=this.recipe,this.isAddFavModalData.isOpen=!0;return}(s=this.loginService)==null||s.openLogin()},setMarkModalTrue(){this.isAddFavModalData.isOpen=!0},setMarkModalFalse(){this.isAddFavModalData.isOpen=!1}}}),Fe={class:"row justify-content-center"},ze={class:"mb-3 d-flex justify-content-between"},Re=["textContent"],$e=["onClick"],Ae=["textContent"],Ce={key:0},De={class:"position-relative"},Se={class:"position-absolute text-slate-900",style:{bottom:"0",left:"18px","background-color":"#fefefe","font-size":"24px","font-weight":"700"}},Ve={class:"d-flex justify-content-between"},Me={class:"d-flex gap-custom align-items-center"},Ue={class:"ml-2"},Ee={style:{"font-size":"24px","font-weight":"500"},class:"mb-5 mt-4 text-slate-900"},Ie={key:0,class:"mb-5"},Te={class:"ingredients"},je={class:"mb-4 text-slate-900",style:{"font-size":"24px","font-weight":"500"}},Ne={class:""},Be={style:{"font-size":"24px","font-weight":"500"},class:"instruction text-slate-900"},Le={style:{"list-style":"none","padding-inline-start":"0"},class:"ml-5 text-slate-900"},Oe={class:"step-number"},He={class:"pb-4 pt-5 d-flex align-items-center justify-content-between"},Pe={class:"mb-4 ratings text-slate-900"},qe={class:"d-flex align-items-center total-rating"},Ge={key:0,class:"position-relative hover-delete-button",style:{width:"fit-content"}},We=["src"],Je={class:"w-100"},Ke={class:"ml-2"},Qe={class:"mt-3 mb-0"},Xe={key:0,class:"mt-5"};function Ye(e,s,V,_,L,ee){var P,q;const h=v("font-awesome-icon"),U=v("router-link"),u=v("b-img"),O=v("b-badge"),w=v("b-row"),d=v("b-avatar"),M=v("b-alert"),R=v("b-form-rating"),D=v("b-form-group"),E=v("b-form-input"),S=v("b-button"),X=v("b-form"),Y=v("b-card"),H=v("b-dropdown-item"),Z=v("b-dropdown"),x=v("b-container"),k=v("mark-or-create-r-b");return p(),y(B,null,[i("div",Fe,[o(x,null,{default:l(()=>{var G,W,J,K,I,n,m;return[i("div",ze,[i("button",{type:"submit",onClick:s[0]||(s[0]=te(t=>e.previousState(),["prevent"])),class:"btn btn-link back-button","data-cy":"entityDetailsBackButton"},[o(h,{icon:"arrow-left"}),s[9]||(s[9]=b(" ")),i("span",{textContent:r(e.t$("szakdolgozatApp.recipe.browse"))},null,8,Re)]),e.recipe.id&&((W=(G=e.recipe)==null?void 0:G.user)==null?void 0:W.id)==((K=(J=e.store)==null?void 0:J.account)==null?void 0:K.id)?(p(),C(U,{key:0,to:{name:"RecipeEdit",params:{recipeId:e.recipe.id}},custom:""},{default:l(({navigate:t})=>[i("button",{onClick:t,class:"btn btn-primary"},[o(h,{icon:"pencil-alt"}),s[10]||(s[10]=b(" ")),i("span",{textContent:r(e.t$("entity.action.edit"))},null,8,Ae)],8,$e)]),_:1},8,["to"])):z("",!0)]),e.recipe?(p(),y("div",Ce,[i("div",De,[o(u,{src:e.recipe.imageUrl,class:"recipe-img",onerror:""},null,8,["src"]),i("p",Se,r(e.recipe.title),1)]),i("div",Ve,[o(w,{style:{gap:"8px"},class:"my-3"},{default:l(()=>[o(O,{variant:"info"},{default:l(()=>[b(r(e.t$(`szakdolgozatApp.FoodCategory.${e.recipe.foodCategory}`)),1)]),_:1}),o(O,{variant:"primary"},{default:l(()=>[b(r(e.t$(`szakdolgozatApp.FoodType.${e.recipe.foodType}`)),1)]),_:1})]),_:1}),i("div",Me,[i("div",{class:"rounded-pill py-1 bg-dark-gray star favorite-badge",style:{padding:"0 2px"},onClick:s[1]||(s[1]=(...t)=>e.toggleFavorite&&e.toggleFavorite(...t))},[o(h,{icon:"heart",style:ge((I=e.recipe)!=null&&I.isFavorite?"color: red":"color: rgb(239, 239, 239)")},null,8,["style"])]),i("div",{class:"rounded-pill p-1 bg-dark-gray favorite-badge",onClick:s[2]||(s[2]=(...t)=>e.setMarkModalTrue&&e.setMarkModalTrue(...t))},[o(h,{icon:"bookmark",style:{color:"rgb(239, 239, 239)"}})])])]),o(w,{class:"align-items-center"},{default:l(()=>{var t;return[o(U,{to:`/profile-view/${(t=e.recipe.user)==null?void 0:t.login}/view`,class:"d-flex align-items-center text-decoration-none"},{default:l(()=>{var c,a,f,g;return[(c=e.recipe.user)!=null&&c.login?(p(),C(d,{key:0,src:e.getAvatarImg((a=e.recipe.user)==null?void 0:a.avatar),size:"xxl"},null,8,["src"])):z("",!0),i("div",Ue,r(((f=e.recipe.user)==null?void 0:f.firstName)+" "+((g=e.recipe.user)==null?void 0:g.lastName)),1)]}),_:1},8,["to"])]}),_:1}),i("div",Ee,r(e.recipe.description),1),((m=(n=e.recipe)==null?void 0:n.instructions)==null?void 0:m.length)>0?(p(),y("div",Ie,[o(w,{style:{gap:"18px","flex-wrap":"nowrap"}},{default:l(()=>{var t,c;return[i("div",Te,[i("p",je,r(e.t$("szakdolgozatApp.recipe.ingredients")),1),(p(!0),y(B,null,Q((t=e.recipe)==null?void 0:t.instructions,(a,f)=>(p(),y("div",{key:f},[(p(!0),y(B,null,Q(a.ingredients,(g,F)=>(p(),y("div",{key:F,class:"my-2 text-slate-900"},[b(r(g.amount)+" ",1),i("strong",null,r(e.$t("szakdolgozatApp.Unit."+g.unit)),1),b(" of "+r(g.name),1)]))),128))]))),128))]),i("div",Ne,[i("p",Be,r(e.t$("szakdolgozatApp.recipe.instructions")),1),i("ul",Le,[(p(!0),y(B,null,Q((c=e.recipe)==null?void 0:c.instructions,(a,f)=>(p(),y("li",{key:f,class:"my-4"},[o(w,{style:{gap:"12px","flex-wrap":"nowrap"}},{default:l(()=>[i("div",null,[i("span",Oe,r(f+1)+". ",1)]),i("div",null,[b(r(a.description)+" ",1),i("p",null,[o(h,{icon:"clock"}),b(" "+r(a.requiredTime)+" minutes ",1)])])]),_:2},1024)]))),128))])])]}),_:1})])):z("",!0),i("div",He,[i("span",Pe,r(e.t$("szakdolgozatApp.recipe.ratings.section")),1),i("div",qe,[o(h,{icon:"star",style:{color:"yellow"}}),i("span",null,r(e.recipe.totalRating),1)])]),e.visibilityRatingEditForm||e.isRatingFormVisible()?(p(),C(M,{key:1,show:"",variant:"info"},{default:l(()=>[o(h,{icon:"info-circle"}),b(" "+r(e.t$("szakdolgozatApp.recipe.ratings.writeRating")),1)]),_:1})):z("",!0),e.visibilityRatingEditForm||e.isRatingFormVisible()?(p(),C(Y,{key:2},{default:l(()=>[o(X,{onSubmit:te(e.submitRating,["prevent"])},{default:l(()=>[o(D,{label:e.t$("szakdolgozatApp.recipe.ratings.rate"),"label-for":"rate"},{default:l(()=>[o(R,{id:"rate",name:"ratingRate",modelValue:e.ratingFormData.rate,"onUpdate:modelValue":s[3]||(s[3]=t=>e.ratingFormData.rate=t)},null,8,["modelValue"])]),_:1},8,["label"]),o(D,{label:e.t$("szakdolgozatApp.recipe.ratings.commentTitle"),"label-for":"title"},{default:l(()=>[o(E,{id:"title",type:"text",name:"ratingTitle",modelValue:e.ratingFormData.title,"onUpdate:modelValue":s[4]||(s[4]=t=>e.ratingFormData.title=t),placeholder:e.t$("szakdolgozatApp.recipe.ratings.commentTitlePh")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(D,{label:e.t$("szakdolgozatApp.recipe.ratings.commentDesc"),"label-for":"description"},{default:l(()=>[o(E,{id:"description",type:"text",name:"ratingDescription",modelValue:e.ratingFormData.description,"onUpdate:modelValue":s[5]||(s[5]=t=>e.ratingFormData.description=t),placeholder:e.t$("szakdolgozatApp.recipe.ratings.commentDescPh")},null,8,["modelValue","placeholder"]),o(D,{label:e.t$("szakdolgozatApp.recipe.ratings.imageLabel"),"label-for":"image",class:"mt-2"},{default:l(()=>[i("input",{id:"file-upload",type:"file",name:"imageUrl",onChange:s[6]||(s[6]=t=>e.onFileChanged(t))},null,32)]),_:1},8,["label"]),e.ratingFormData.imageUrl?(p(),y("div",Ge,[o(S,{class:"position-absolute rounded-circle",variant:"danger",onClick:e.deleteImgFromRating,size:"sm",style:{right:"5px",top:"5px",padding:"2px"}},{default:l(()=>[o(h,{icon:"close"})]),_:1},8,["onClick"]),i("img",{src:e.ratingFormData.imageUrl,style:{width:"150px",height:"150px","object-fit":"cover"},alt:"rating image"},null,8,We)])):z("",!0)]),_:1},8,["label"]),o(S,{class:"btn btn-primary mt-4",variant:"primary",type:"submit",textContent:r(e.t$("szakdolgozatApp.recipe.ratings.giveRating"))},null,8,["textContent"])]),_:1},8,["onSubmit"])]),_:1})):z("",!0),o(w,{class:"mt-5"},{default:l(()=>{var t,c;return[i("div",Je,[i("div",null,[(p(!0),y(B,null,Q(e.limitedRatings,(a,f)=>(p(),y("div",{key:f},[o(w,{class:"align-items-center justify-content-between"},{default:l(()=>[i("div",null,[o(w,{class:"align-items-center mb-2"},{default:l(()=>{var g;return[o(U,{to:`/profile-view/${(g=a.user)==null?void 0:g.login}/view`,class:"d-flex align-items-center text-decoration-none"},{default:l(()=>{var F,$,T,j;return[(F=a.user)!=null&&F.login?(p(),C(d,{key:0,src:e.getAvatarImg(($=a.user)==null?void 0:$.avatar),size:"xxl"},null,8,["src"])):z("",!0),i("div",Ke,r(((T=a.user)==null?void 0:T.firstName)+" "+((j=a.user)==null?void 0:j.lastName)),1)]}),_:2},1032,["to"])]}),_:2},1024),o(R,{id:"rate",name:"ratingRate",style:{"max-width":"160px",width:"160px"},readonly:"",modelValue:a.rate,"onUpdate:modelValue":g=>a.rate=g},null,8,["modelValue","onUpdate:modelValue"])]),e.isMyComment(a)?(p(),C(Z,{key:0,text:""},{default:l(()=>[o(H,{onClick:g=>e.toggleEditRatingForm(a)},{default:l(()=>[b(r(e.t$("szakdolgozatApp.recipeBook.card.edit")),1)]),_:2},1032,["onClick"]),o(H,{variant:"danger",onClick:g=>e.deleteRating(a.id)},{default:l(()=>[b(r(e.t$("szakdolgozatApp.recipe.home.deleteRating")),1)]),_:2},1032,["onClick"])]),_:2},1024)):z("",!0)]),_:2},1024),o(w,null,{default:l(()=>[o(w,{class:"justify-content-between w-100"},{default:l(()=>[i("div",null,[i("p",Qe,[i("strong",null,r(a.title),1)]),i("p",null,r(a.description),1)]),o(u,{class:"rating_img",src:a.imageUrl,fluid:""},null,8,["src"])]),_:2},1024)]),_:2},1024),s[11]||(s[11]=i("hr",null,null,-1))]))),128)),((c=(t=e.recipe)==null?void 0:t.ratings)==null?void 0:c.length)>2?(p(),y("div",Xe,[e.showAllRatings?(p(),C(S,{key:1,onClick:s[8]||(s[8]=a=>e.showAllRatings=!1)},{default:l(()=>[b(r(e.t$("szakdolgozatApp.recipe.ratings.showLess")),1)]),_:1})):(p(),C(S,{key:0,onClick:s[7]||(s[7]=a=>e.showAllRatings=!0)},{default:l(()=>[b(r(e.t$("szakdolgozatApp.recipe.ratings.showMore")),1)]),_:1})),o(S,{class:"ml-3",to:"/recipe/"+e.recipe.id+"/ratings"},{default:l(()=>[b(r(e.t$("szakdolgozatApp.recipe.ratings.checkAll")),1)]),_:1},8,["to"])])):z("",!0)])])]}),_:1})])):z("",!0)]}),_:1})]),i("p",null,r((P=e.isAddFavModalData.recipe)==null?void 0:P.id),1),o(k,{"on-close":e.setMarkModalFalse,"is-open":e.isAddFavModalData.isOpen,"recipe-id":(q=e.recipe)==null?void 0:q.id},null,8,["on-close","is-open","recipe-id"])],64)}const rt=me(_e,[["render",Ye]]);export{rt as default};
