import{d as Ce,g as De,u as ae,B as Ve,C as we,i as V,f as Re,G as Se,r as b,c as G,w as ne,o as Te,V as se,_ as $e,j as p,k as d,t as f,s as c,q as a,y as g,m as s,E as B,x as Z,H as x,F as q,v as z,D as H,I as Ie,l as Q}from"./app-9yHSs_0k.js";import{R as Be}from"./recipe.service-oeltP7nx.js";import{I as qe}from"./ingredient.service-BzC0g82u.js";import{F as Ae}from"./favorite-relation.service-D7ARiYm2.js";import{R as Ne}from"./recipe-book.service-D-CAdHjl.js";import{f as J}from"./functions-BhiSqBls.js";import{_ as Oe}from"./CreateRecipeBookForm.vue_vue_type_script_setup_true_lang-C0RjFM7P.js";import{_ as Pe}from"./MarkOrCreateRB.vue_vue_type_script_setup_true_lang-Ybhu4xwr.js";import{h as Me}from"./header-bg-C45d2Xww.js";import{R as Ue}from"./RecipeCard-BrGL8P1u.js";const je=Ce({components:{MarkOrCreateRB:Pe,RecipeCard:Ue,CreateRecipeBookForm:Oe,FontAwesomeIcon:De},setup(){const{t:e}=ae(),o=Ve(),A=we(),k=V("loginService"),K=V("recipeService",()=>new Be),ee=V("ingredientService",()=>new qe),W=V("favoriteService",()=>new Ae),N=V("recipeBookService",()=>new Ne),O=V("alertService",()=>Re(),!0),E=Se(),h=b({isOpen:!1,recipe:{}}),X=V("authenticated"),m={foodCategories:o.query.foodCategories||[],foodTypes:o.query.foodTypes||[],recipeTitle:o.query.recipeTitle||"",ingredientNames:o.query.ingredientName||[],page:o.query.page||0,sort:o.query.sort||"createdDate,asc"},u=b(te(o.query.sort||"createdDate,asc")),w=[{label:e("search.input.title"),value:"title"},{label:e("search.input.creationDate"),value:"createdDate"}],R=b(!1),S=b([]),T=b(["Nill"]),P=b([]),M=b(!1);let $=J.getAllFoodTypes(),I=J.getAllFoodCategories();const C=b([]),n=[],y=[],_=[];$=Y($),I=Y(I),C.value=Y(C.value);const v=Object.values($),D=Object.values(I),r=G(()=>Object.values(C.value));ne(()=>o.query.page,t=>{console.log(o.query),F.value.currentPage=t?parseInt(t):0,m.page=t?parseInt(t):0,j()});const F=b({totalElements:0,currentPage:parseInt(o.query.page)-1,totalPages:0}),re=G(()=>v.map(t=>({text:t.label,value:t.value}))),ie=G(()=>D.map(t=>({text:t.label,value:t.value}))),le=G(()=>r.value.filter(t=>_.indexOf(t)===-1).sort((t,l)=>t==null?void 0:t.localeCompare(l))),ue=()=>{},U=b(!1),ce=async()=>{U.value=!0;try{const t=await K().retrieve();S.value=t.data}catch{}finally{U.value=!1}},de=async()=>{U.value=!0;try{const t=await ee().retrieveUniqueIngredients();C.value=t.data}catch{}finally{U.value=!1}};Te(async()=>{await de(),await j()});function pe(){const t=L(u.value.sortBy,u.value.sortDirection);A.push({query:{...o.query,sort:t}}),j()}ne(()=>o.query.sort,t=>{t&&(u.value=te(t))});function te(t){const[l,i]=t.split(",");return{sortBy:l,sortDirection:i==="asc"}}function L(t,l){const i=l?"asc":"desc";return console.log(i),`${t},${i}`}const j=async()=>{console.log("search sort: "+u.value.sortDirection),T.value=[],m.sort=L(u.value.sortBy,u.value.sortDirection),await K().searchRecipes(m).then(t=>{var l,i;F.value={...F.value,totalElements:(l=t==null?void 0:t.data)==null?void 0:l.totalElements,currentPage:(i=t==null?void 0:t.data)==null?void 0:i.number,totalPages:t.data.totalPages},T.value=t.data.content,R.value=t.data.content.length>0}),A.push({query:{...o.query,page:m.page,sort:L(u.value.sortBy,u.value.sortDirection),foodTypes:m.foodTypes,foodCategories:m.foodCategories,recipeTitle:m.recipeTitle,ingredientNames:m.ingredientNames}})};function me(){const t=L(u.value.sortBy,u.value.sortDirection);A.push({query:{...o.query,sort:t}})}function fe(){u.value.sortDirection=!u.value.sortDirection,me(),j()}function Y(t){return Object.fromEntries(Object.entries(t).filter(([l,i])=>l!="null"&&i!=""))}function ge(t){if(E.account){h.value.recipe=t,h.value.isOpen=!0;return}k==null||k.openLogin()}function ve(){h.value.isOpen=!1}function be(t){if(E.account){W().create({recipe:t}).then(l=>{if(l.status==204||l.status==201){const i=T.value.find(oe=>oe.id===t.id);console.log(i),i&&(se.set(i,"isFavorite",!i.isFavorite),se.set(i,"favoriteCount",i.isFavorite?i.favoriteCount+1:i.favoriteCount-1))}});return}k==null||k.openLogin()}function he(t){const l=parseInt(t.target.text)-1;A.push({query:{...o.query,page:l}}),F.value.currentPage=l}function ye(t){var l;N().addOrRemoveRecipe(t,(l=h.value.recipe)==null?void 0:l.id).then(i=>{i.status==201?O.showSuccess("Added successfully"):i.status==204&&O.showInfo("Removed successfully")}).catch(i=>{O.showError("Something went wrong! Try it again later.")})}function _e(){M.value=!M.value}function Fe(){return"#"}function ke(t){if(!t){console.error("Recipe book is null!");return}P.value=[...P.value,t]}return{authenticated:X,searchFormData:m,recipes:S,filteredRecipes:T,foodTypeValue:n,foodCategoryValue:y,foodCategories:I,foodTypes:$,ingredientValue:_,availableFoodTypes:re,availableFoodCategories:ie,availableIngredients:le,isFetching:U,didSearch:R,paginationInfo:F,isAddFavModalData:h,userRecipeBooks:P,newRecipeBFormVisible:M,sortFormData:u,onSortChange:pe,toggleSortDirection:fe,sortOptions:w,addRecipeBookToList:ke,closeMarkModal:ve,headerBg:Me,pLinkGen:Fe,markRecipe:ge,toggleNewRecipeBVisible:_e,addOrRemoveFromRecipeBook:ye,onPageChange:he,search:j,toggleFavorite:be,retrieveRecipes:ce,clear:ue,t$:ae().t}},computed:{functions(){return J}},compatConfig:{MODE:3},methods:{getAvatarImg:e=>J.getAvatarImg(e),formatFoodCategory(e){return e?e.replace(/_/g," ").replace(/\b\w/g,o=>o.toUpperCase()):""}}}),ze={class:"container"},Ee={class:"d-flex justify-content-center flex-column"},Le={class:"position-relative text-center my-5"},Ge=["textContent"],He={class:"d-flex mt-4 justify-content-between w-100"},Qe={class:"flex-lg-grow-1 w-100"},Je={key:0,class:"list-inline d-inline-block mb-2"},Ke={key:0,class:"list-inline d-inline-block mb-2"},We={key:0,class:"list-inline d-inline-block mb-2"},Xe={class:"d-flex custom-pagination justify-content-between mt-4"},Ye={class:"text-slate-900"},Ze={class:"d-flex align-items-center"},xe={class:"d-flex align-items-center"},et={class:""},tt={class:"text-slate-900"},ot={key:0,class:"recipe-search-result"};function at(e,o,A,k,K,ee){var C;const W=p("b-img"),N=p("font-awesome-icon"),O=p("b-alert"),E=p("b-form-input"),h=p("b-button"),X=p("b-input-group-append"),m=p("b-input-group"),u=p("b-form-group"),w=p("b-form-select"),R=p("b-form-tag"),S=p("b-form-tags"),T=p("b-form"),P=p("b-form-select-option"),M=p("recipe-card"),$=p("b-pagination-nav"),I=p("mark-or-create-r-b");return d(),f(q,null,[c("div",ze,[c("div",Ee,[c("div",Le,[a(W,{src:e.headerBg,class:"header-img"},null,8,["src"]),c("h1",{class:"carousel-header-text mb-1 position-relative",textContent:g(e.t$("search.title"))},null,8,Ge)]),a(O,{variant:"info",show:""},{default:s(()=>[a(N,{icon:"search"}),B(" "+g(e.t$("search.subtitle")),1)]),_:1}),c("div",null,[a(T,{onSubmit:o[7]||(o[7]=Ie(n=>e.search(),["prevent"]))},{default:s(()=>[a(u,{label:e.t$("search.input.recipeTitle")},{default:s(()=>[a(m,null,{default:s(()=>[a(E,{modelValue:e.searchFormData.recipeTitle,"onUpdate:modelValue":o[0]||(o[0]=n=>e.searchFormData.recipeTitle=n),placeholder:e.t$("search.input.recipeTitlePH")},null,8,["modelValue","placeholder"]),a(X,null,{default:s(()=>[a(h,{type:"submit",variant:"primary",textContent:g(e.t$("search.searchButton"))},null,8,["textContent"])]),_:1})]),_:1})]),_:1},8,["label"]),c("div",He,[c("div",Qe,[a(u,{label:e.t$("search.input.foodTypes")},{default:s(()=>[a(S,{id:"tags-component-select",modelValue:e.searchFormData.foodTypes,"onUpdate:modelValue":o[2]||(o[2]=n=>e.searchFormData.foodTypes=n),size:"lg",class:"mb-2","add-on-change":"","no-outer-focus":""},{default:s(({tags:n,inputAttrs:y,inputHandlers:_,disabled:v,removeTag:D})=>[a(w,Z(y,x(_),{modelValue:e.searchFormData.foodTypes,"onUpdate:modelValue":o[1]||(o[1]=r=>e.searchFormData.foodTypes=r),disabled:v||e.availableFoodTypes.length===0,options:e.availableFoodTypes}),{first:s(()=>o[9]||(o[9]=[c("option",{disabled:"",value:""},"Choose a tag...",-1)])),_:2},1040,["modelValue","disabled","options"]),n.length>0?(d(),f("ul",Je,[(d(!0),f(q,null,z(n,r=>(d(),f("li",{key:r,class:"list-inline-item"},[a(R,{onRemove:F=>D(r),title:r,disabled:v,variant:"info"},{default:s(()=>[B(g(e.t$(`szakdolgozatApp.FoodType.${r}`)),1)]),_:2},1032,["onRemove","title","disabled"])]))),128))])):H("",!0)]),_:1},8,["modelValue"])]),_:1},8,["label"])]),a(u,{label:e.t$("search.input.foodCategories"),class:"flex-lg-grow-1 w-100"},{default:s(()=>[a(m,null,{default:s(()=>[a(S,{id:"tags-component-select",modelValue:e.searchFormData.foodCategories,"onUpdate:modelValue":o[4]||(o[4]=n=>e.searchFormData.foodCategories=n),size:"lg",class:"mb-2","add-on-change":"","no-outer-focus":""},{default:s(({tags:n,inputAttrs:y,inputHandlers:_,disabled:v,removeTag:D})=>[a(w,Z(y,x(_),{modelValue:e.searchFormData.foodCategories,"onUpdate:modelValue":o[3]||(o[3]=r=>e.searchFormData.foodCategories=r),disabled:v||e.availableFoodCategories.length===0,options:e.availableFoodCategories}),{first:s(()=>o[10]||(o[10]=[c("option",{disabled:"",value:""},"Choose a tag...",-1)])),_:2},1040,["modelValue","disabled","options"]),n.length>0?(d(),f("ul",Ke,[(d(!0),f(q,null,z(n,r=>(d(),f("li",{key:r,class:"list-inline-item"},[a(R,{onRemove:F=>D(r),title:r,disabled:v,variant:"info"},{default:s(()=>[B(g(e.t$(`szakdolgozatApp.FoodCategory.${r}`)),1)]),_:2},1032,["onRemove","title","disabled"])]))),128))])):H("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),a(u,{label:e.t$("search.input.ingredients"),class:"flex-lg-grow-1 w-100"},{default:s(()=>[a(m,null,{default:s(()=>[a(S,{id:"tags-component-select",modelValue:e.searchFormData.ingredientNames,"onUpdate:modelValue":o[6]||(o[6]=n=>e.searchFormData.ingredientNames=n),size:"lg",class:"mb-2","add-on-change":"","no-outer-focus":""},{default:s(({tags:n,inputAttrs:y,inputHandlers:_,disabled:v,removeTag:D})=>[a(w,Z(y,x(_),{modelValue:e.searchFormData.ingredientNames,"onUpdate:modelValue":o[5]||(o[5]=r=>e.searchFormData.ingredientNames=r),disabled:v||e.availableIngredients.length===0,options:e.availableIngredients}),{first:s(()=>o[11]||(o[11]=[c("option",{disabled:"",value:""},"Choose a tag...",-1)])),_:2},1040,["modelValue","disabled","options"]),n.length>0?(d(),f("ul",We,[(d(!0),f(q,null,z(n,r=>(d(),f("li",{key:r,class:"list-inline-item"},[a(R,{onRemove:F=>D(r),title:r,disabled:v,variant:"info"},{default:s(()=>[B(g(r),1)]),_:2},1032,["onRemove","title","disabled"])]))),128))])):H("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"])])]),_:1})])]),c("div",Xe,[c("div",null,[c("p",Ye,g(e.paginationInfo.currentPage+1)+". "+g(e.t$("search.page")),1)]),c("div",Ze,[c("div",xe,[a(w,{modelValue:e.sortFormData.sortBy,"onUpdate:modelValue":o[8]||(o[8]=n=>e.sortFormData.sortBy=n),onChange:e.onSortChange,style:{width:"auto","margin-right":"10px"}},{default:s(()=>[(d(!0),f(q,null,z(e.sortOptions,(n,y)=>(d(),Q(P,{key:y,value:n.value},{default:s(()=>[B(g(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","onChange"]),e.sortFormData.sortDirection?(d(),Q(h,{key:0,variant:e.sortFormData.sortDirection?"dark":"light",onClick:e.toggleSortDirection,style:{"font-size":"22px",display:"flex","align-items":"center"}},{default:s(()=>[a(N,{icon:"sort-amount-desc"})]),_:1},8,["variant","onClick"])):(d(),Q(h,{key:1,variant:e.sortFormData.sortDirection?"light":"dark",onClick:e.toggleSortDirection,style:{"font-size":"22px",display:"flex","align-items":"center"}},{default:s(()=>[a(N,{icon:"sort-amount-asc"})]),_:1},8,["variant","onClick"]))])]),c("div",et,[c("p",tt,[B(g(e.paginationInfo.totalElements)+" ",1),c("span",null,g(e.t$("search.result")),1)])])]),e.didSearch?(d(),f("div",ot,[(d(!0),f(q,null,z(e.filteredRecipes,n=>(d(),Q(M,{key:n,recipe:n,"mark-recipe":e.markRecipe,"show-user":!0,"toggle-favorite":e.toggleFavorite},null,8,["recipe","mark-recipe","toggle-favorite"]))),128))])):H("",!0),a($,{"number-of-pages":e.paginationInfo.totalPages,page:e.paginationInfo.currentPage,"link-gen":e.pLinkGen,onclick:e.onPageChange,class:"mt-5",value:parseInt(e.paginationInfo.currentPage)+1,"hide-goto-end-buttons":""},null,8,["number-of-pages","page","link-gen","onclick","value"])]),a(I,{"on-close":e.closeMarkModal,"is-open":e.isAddFavModalData.isOpen,"recipe-id":(C=e.isAddFavModalData.recipe)==null?void 0:C.id},null,8,["on-close","is-open","recipe-id"])],64)}const ft=$e(je,[["render",at],["__scopeId","data-v-466bffe4"]]);export{ft as default};
